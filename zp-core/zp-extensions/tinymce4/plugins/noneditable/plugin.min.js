tinymce.PluginManager.add("noneditable",function(e){function t(){function t(e){var t;if(1===e.nodeType){if(t=e.getAttribute(f),t&&"inherit"!==t)return t;if(t=e.contentEditable,"inherit"!==t)return t}return null}function n(e){for(var n;e;){if(n=t(e))return"false"===n?e:null;e=e.parentNode}}function r(e){for(;e;){if(e.id===m)return e;e=e.parentNode}}function a(e){var t;if(e)for(t=new o(e,e),e=t.current();e;e=t.next())if(3===e.nodeType)return e}function i(n,r){var a,i;return"false"===t(n)&&s.isBlock(n)?(g.select(n),void 0):(i=s.createRng(),"true"===t(n)&&(n.firstChild||n.appendChild(e.getDoc().createTextNode(" ")),n=n.firstChild,r=!0),a=s.create("span",{id:m,"data-mce-bogus":!0},v),r?n.parentNode.insertBefore(a,n):s.insertAfter(a,n),i.setStart(a.firstChild,1),i.collapse(!0),g.setRng(i),a)}function l(e){var t,n,i,o;if(e)t=g.getRng(!0),t.setStartBefore(e),t.setEndBefore(e),n=a(e),n&&n.nodeValue.charAt(0)==v&&(n=n.deleteData(0,1)),s.remove(e,!0),g.setRng(t);else for(i=r(g.getStart());(e=s.get(m))&&e!==o;)i!==e&&(n=a(e),n&&n.nodeValue.charAt(0)==v&&(n=n.deleteData(0,1)),s.remove(e,!0)),o=e}function u(){function e(e,n){var r,a,i,l,f;if(r=d.startContainer,a=d.startOffset,3==r.nodeType){if(f=r.nodeValue.length,a>0&&f>a||(n?a==f:0===a))return}else{if(!(a<r.childNodes.length))return n?null:e;var u=!n&&a>0?a-1:a;r=r.childNodes[u],r.hasChildNodes()&&(r=r.firstChild)}for(i=new o(r,e);l=i[n?"prev":"next"]();){if(3===l.nodeType&&l.nodeValue.length>0)return;if("true"===t(l))return l}return e}var r,a,f,d,u;l(),f=g.isCollapsed(),r=n(g.getStart()),a=n(g.getEnd()),(r||a)&&(d=g.getRng(!0),f?(r=r||a,(u=e(r,!0))?i(u,!0):(u=e(r,!1))?i(u,!1):g.select(r)):(d=g.getRng(!0),r&&d.setStartBefore(r),a&&d.setEndAfter(a),g.setRng(d)))}function c(a){function i(e,t){for(;e=e[t?"previousSibling":"nextSibling"];)if(3!==e.nodeType||e.nodeValue.length>0)return e}function f(e,t){g.select(e),g.collapse(t)}function c(a){function i(e){for(var t=f;t;){if(t===e)return;t=t.parentNode}s.remove(e),u()}function o(){var r,o,l=e.schema.getNonEmptyElements();for(o=new tinymce.dom.TreeWalker(f,e.getBody());(r=a?o.prev():o.next())&&!l[r.nodeName.toLowerCase()]&&!(3===r.nodeType&&tinymce.trim(r.nodeValue).length>0);)if("false"===t(r))return i(r),!0;return n(r)?!0:!1}var l,f,d,c;if(g.isCollapsed()){if(l=g.getRng(!0),f=l.startContainer,d=l.startOffset,f=r(f)||f,c=n(f))return i(c),!1;if(3==f.nodeType&&(a?d>0:d<f.nodeValue.length))return!0;if(1==f.nodeType&&(f=f.childNodes[d]||f),o())return!1}return!0}var m,v,p,E,h=a.keyCode;if(p=g.getStart(),E=g.getEnd(),m=n(p)||n(E),m&&(112>h||h>124)&&h!=d.DELETE&&h!=d.BACKSPACE){if((tinymce.isMac?a.metaKey:a.ctrlKey)&&(67==h||88==h||86==h))return;if(a.preventDefault(),h==d.LEFT||h==d.RIGHT){var y=h==d.LEFT;if(e.dom.isBlock(m)){var T=y?m.previousSibling:m.nextSibling,C=new o(T,T),b=y?C.prev():C.next();f(b,!y)}else f(m,y)}}else if(h==d.LEFT||h==d.RIGHT||h==d.BACKSPACE||h==d.DELETE){if(v=r(p)){if(h==d.LEFT||h==d.BACKSPACE)if(m=i(v,!0),m&&"false"===t(m)){if(a.preventDefault(),h!=d.LEFT)return s.remove(m),void 0;f(m,!0)}else l(v);if(h==d.RIGHT||h==d.DELETE)if(m=i(v),m&&"false"===t(m)){if(a.preventDefault(),h!=d.RIGHT)return s.remove(m),void 0;f(m,!1)}else l(v)}if((h==d.BACKSPACE||h==d.DELETE)&&!c(h==d.BACKSPACE))return a.preventDefault(),!1}}var s=e.dom,g=e.selection,m="mce_noneditablecaret",v="﻿";e.on("mousedown",function(n){var r=e.selection.getNode();"false"===t(r)&&r==n.target&&u()}),e.on("mouseup keyup",u),e.on("keydown",c)}function n(t){var n=i.length,r=t.content,o=tinymce.trim(a);if("raw"!=t.format){for(;n--;)r=r.replace(i[n],function(t){var n=arguments,a=n[n.length-2];return a>0&&'"'==r.charAt(a-1)?t:'<span class="'+o+'" data-mce-content="'+e.dom.encode(n[0])+'">'+e.dom.encode("string"==typeof n[1]?n[1]:n[0])+"</span>"});t.content=r}}var r,a,i,o=tinymce.dom.TreeWalker,l="contenteditable",f="data-mce-"+l,d=tinymce.util.VK;r=" "+tinymce.trim(e.getParam("noneditable_editable_class","mceEditable"))+" ",a=" "+tinymce.trim(e.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",i=e.getParam("noneditable_regexp"),i&&!i.length&&(i=[i]),e.on("PreInit",function(){t(),i&&e.on("BeforeSetContent",n),e.parser.addAttributeFilter("class",function(e){for(var t,n,i=e.length;i--;)n=e[i],t=" "+n.attr("class")+" ",-1!==t.indexOf(r)?n.attr(f,"true"):-1!==t.indexOf(a)&&n.attr(f,"false")}),e.serializer.addAttributeFilter(f,function(e){for(var t,n=e.length;n--;)t=e[n],i&&t.attr("data-mce-content")?(t.name="#text",t.type=3,t.raw=!0,t.value=t.attr("data-mce-content")):(t.attr(l,null),t.attr(f,null))}),e.parser.addAttributeFilter(l,function(e){for(var t,n=e.length;n--;)t=e[n],t.attr(f,t.attr(l)),t.attr(l,null)})})});